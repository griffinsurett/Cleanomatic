---
// src/layouts/ServicesLayout.astro
import BaseLayout from "./BaseLayout.astro";
import SecondaryHero from "@/components/StaticSections/SecondaryHero.astro";
import Section from "@/components/Section.astro";
import QuoteForm from "@/components/StaticSections/QuoteForm.astro";
import { Image } from "astro:assets";
import { capitalize } from "@/utils/ContentUtils";

const {
  collection,
  entry,
  title: overrideTitle,
  description: overrideDesc,
  keywords,
  ogType,
  ...rest
} = Astro.props;

const isItemPage = Boolean(entry);
const data = entry?.data || {};
const pageTitle =
  overrideTitle ?? (isItemPage ? data.title : capitalize(collection));
const pageDesc =
  overrideDesc ?? (isItemPage ? data.description : rest.description);
---

<BaseLayout
  title={pageTitle}
  description={pageDesc}
  keywords={keywords}
  ogType={ogType}
  {...rest}
>
  <!-- Hero for both collection roots and item pages -->
  <SecondaryHero title={pageTitle} />

  <!-- Service item content -->
  {
    isItemPage && (
      <Section
        variant="imageCol2"
        topContentClass="lg:w-2/3"
        heading={[{ text: data.title, class: "h4" }]}
        description={data.description}
        buttons={[
          {
            text: "Get a Quote",
            link: `#static-default-${entry.slug}`,
            variant: "primary",
          },
        ]}
      >
        {data.featuredImage && (
          <Image
            src={data.featuredImage}
            alt={data.title}
            width={600}
            height={400}
            format="avif"
            class="mb-[var(--spacing-md)]"
          />
        )}
        <slot />
      </Section>
    )
  }

  <!-- Common sections for services pages -->
  <Section collection="testimonials" query="getAll" />
  <Section collection="serviceAreas" query="getAll" />
  <Section collection="gallery" query="getAll" />
  <Section collection="faq" query="related" />
  <Section collection="services" query="sibling" headingAreaClass="hidden" />

  <!-- Contact / Quote form -->
  <QuoteForm />
</BaseLayout>
