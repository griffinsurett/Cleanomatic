---
// src/layouts/ServicesLayout.astro
import BaseLayout from "./BaseLayout.astro";
import SecondaryHero from "@/components/StaticSections/SecondaryHero.astro";
import Section from "@/components/Section.astro";
import QuoteForm from "@/components/StaticSections/QuoteForm.astro";
import { Image } from "astro:assets";
import { capitalize } from "@/utils/ContentUtils";

const {
  collection,
  entry,
  title: overrideTitle,
  description: overrideDesc,
  keywords,
  ogType,
  ...rest
} = Astro.props;

const isItemPage = Boolean(entry);
const data = entry?.data || {};
const pageTitle =
  overrideTitle ?? (isItemPage ? data.title : capitalize(collection));
const pageDesc =
  overrideDesc ?? (isItemPage ? data.description : rest.description);
---

<BaseLayout
  title={pageTitle}
  description={pageDesc}
  keywords={keywords}
  ogType={ogType}
  {...rest}
>
  <!-- Hero for both collection roots and item pages -->
  <SecondaryHero title={pageTitle} />

  <!-- Service item content -->
  {
    isItemPage && (
      <Section
        variant="description"
        contentClass="flex flex-col lg:flex-row items-center justify-center"
        topContentClass="w-9/10 py-[var(--spacing-2xl)]"
        heading={[{ text: data.title, class: "hidden" }]}
        description={data.description}
        buttonsSectionClass="hidden"
        buttons={[
          {
            text: "Get a Quote",
            link: `#static-default-${entry.slug}`,
            variant: "primary",
          },
        ]}
      ></Section>
    )
  }
  <slot />

  <Section
    heading={[
      {
        text: "From Mess to Masterpiece",
        tagName: "h2",
        class: "h2 text-bg mb-[var(--spacing-sm)] load slide-up",
      },
      {
        text: "We don’t just clean— we conquer chaos.",
        tagName: "h6",
        class: "h6 text-bg load slide-up",
      },
    ]}
    sectionClass="bg-accent py-[var(--spacing-xl)] md:py-[var(--spacing-2xl)] lg:py-[var(--spacing-3xl)] text-bg"
    contentClass="text-center"
    childSlotClass="flex flex-col text-center justify-center"
  >
    <div
      class="galleries flex flex-col justify-center items-center py-[var(--spacing-xl)] md:py-[var(--spacing-2xl)] lg:py-[var(--spacing-3xl)] gap-[var(--spacing-xl)]"
    >
      <!-- Dirty Before Gallery -->
      <Section
        collection="gallery"
        query="getAll"
        variant="gallery2"
        heading={[
          {
            text: "Before: The Mess",
            tagName: "h3",
            class: "h3 text-bg load slide-up",
          },
        ]}
      />

      <!-- Sparkling After Gallery -->
      <Section
        collection="gallery"
        query="getAll"
        variant="gallery2"
        heading={[
          {
            text: "After: The Masterpiece",
            tagName: "h3",
            class: "h3 text-bg load slide-up",
          },
        ]}
      />
    </div>
  </Section>

  <!-- Common sections for services pages -->
  <Section collection="testimonials" query="getAll" />
  <Section collection="serviceAreas" query="getAll" />
  <!-- <Section collection="gallery" query="getAll" /> -->
  <Section collection="faq" query="related" />
  <!-- <Section collection="services" query="sibling" headingAreaClass="hidden" /> -->

  <!-- Contact / Quote form -->
  <QuoteForm />
</BaseLayout>
