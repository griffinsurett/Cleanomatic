---
/* Uses the generic <Form> wrapper but keeps the same visual layout */
  import Form      from "@/components/Forms/Form.astro";
import TextInput from "@/components/Forms/Inputs/TextInput.astro";
import Textarea  from "@/components/Forms/Inputs/Textarea.astro";
import { getCurrentEntryId } from "@/utils/CurrentEntry";

const {
  inputClasses = "border border-[var(--color-border)] transition-default p-[var(--spacing-md)] w-full bg-light-opacity placeholder:text-[var(--color-bg)] text-bg outline-none focus:border-[var(--color-bg)] focus:ring-1 focus:ring-[var(--color-primary)] focus:bg-primary",
  wrapperClasses = "mb-[var(--spacing-sm)] w-full",
} = Astro.props;

// Extract current page identifier
const currentPage = getCurrentEntryId(Astro);
console.log("Current page:", currentPage);
---

<Form name="contact-form" netlify={true} >
  <!-- Hidden input for current page -->
  <input type="hidden" name="Page-of-Submission" value={currentPage} />

  <!-- Row 1 -->
  <div class="flex flex-col lg:flex-row lg:space-x-[var(--spacing-sm)]">
    <div class="w-full lg:w-1/2">
      <TextInput
        name="firstName"
        placeholder="First Name"
        required={true}
        inputClass={inputClasses}
        wrapperClass={wrapperClasses}
      />
    </div>
    <div class="w-full lg:w-1/2">
      <TextInput
        name="lastName"
        placeholder="Last Name"
        required={true}
        inputClass={inputClasses}
        wrapperClass={wrapperClasses}
      />
    </div>
  </div>

  <!-- Row 2 -->
  <div class="flex flex-col lg:flex-row lg:space-x-[var(--spacing-sm)]">
    <div class="w-full lg:w-1/2">
      <TextInput
        name="email"
        type="email"
        placeholder="you@example.com"
        required={true}
        inputClass={inputClasses}
        wrapperClass={wrapperClasses}
      />
    </div>
    <div class="w-full lg:w-1/2">
      <TextInput
        name="phone"
        type="tel"
        placeholder="123-456-7890"
        inputClass={inputClasses}
        wrapperClass={wrapperClasses}
      />
    </div>
  </div>

  <!-- Row 3 -->
  <div class="w-full">
    <Textarea
      name="message"
      placeholder="Tell us more about your needsâ€¦"
      required={true}
      rows={5}
      inputClass={inputClasses}
      wrapperClass={wrapperClasses}
    />
  </div>

  <!-- Submit button comes from <Form> fallback, so no submit slot needed -->
</Form>
<script>
  // Wait until the DOM is ready
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.querySelector('form[name="contact-form"]');
    const successBanner = document.createElement("div");
    successBanner.className = "p-[var(--spacing-sm)] bg-primary text-bg border border-[var(--color-border)] bg-light-opacity";
    successBanner.textContent =
      "Thank you for your message. We will get in touch with you shortly.";

    form.addEventListener("submit", async (e) => {
      // 1. Stop the browser from navigating away
      e.preventDefault();                      // :contentReference[oaicite:1]{index=1}  

      // 2. Prepare form data
      const data = new URLSearchParams(new FormData(form));

      // 3. Send it to Netlify
      await fetch("/", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: data.toString(),
      });

      // 4. Swap out the form for the banner
      form.style.display = "none";             // :contentReference[oaicite:2]{index=2}  
      form.parentNode.insertBefore(successBanner, form.nextSibling);
    });
  });
</script>
